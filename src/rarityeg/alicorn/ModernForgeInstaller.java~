package rarityeg.alicorn;

<<<<<<< HEAD
import java.io.File;
import java.io.OutputStream;
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.util.function.Predicate;

public class ModernForgeInstaller {
    public static int installClient(String path) {
        try {
            Class<?> cUtil = Class.forName("net.minecraftforge.installer.json.Util");
            Class<?> cInstall = Class.forName("net.minecraftforge.installer.json.InstallV1");
            Class<?> cProgressCallback = Class.forName("net.minecraftforge.installer.actions.ProgressCallback");
            Class<?> cClientInstall = Class.forName("net.minecraftforge.installer.actions.ClientInstall");
            Class<?> cSimpleInstaller = Class.forName("net.minecraftforge.installer.SimpleInstaller");
            Method mLoadInstallProfile = cUtil.getMethod("loadInstallProfile");
            Object profile = mLoadInstallProfile.invoke(null);
            Constructor<?> conClientInstall = cClientInstall.getConstructor(cInstall, cProgressCallback);
            Method mWithOutputs = cProgressCallback.getMethod("withOutputs", OutputStream[].class);
            OutputStream[] os = {System.out};
            Object output = mWithOutputs.invoke(null, (Object) os);
            Object clientInstall = conClientInstall.newInstance(profile, output); // ClientInstall
            Field headless = cSimpleInstaller.getField("headless");
            headless.setBoolean(null, true);
            Method mRun = cClientInstall.getMethod("run", File.class, Predicate.class, File.class);
            Predicate<?> p = o -> true;
            Object state = mRun.invoke(clientInstall, new File(path), p, new File(""));
            if ((boolean) state) {
                return 0;
            }
            return 1;
        } catch (Exception e) {
            e.printStackTrace();
            return 1;
        }
=======
import net.minecraftforge.installer.SimpleInstaller;
import net.minecraftforge.installer.actions.ClientInstall;
import net.minecraftforge.installer.actions.ProgressCallback;
import net.minecraftforge.installer.json.Install;
import net.minecraftforge.installer.json.Util;

import java.io.File;

public class ModernForgeInstaller {
    public static int installClient(String path) {
        Install profile = Util.loadInstallProfile();
        ClientInstall clientInstall = new ClientInstall(profile, ProgressCallback.withOutputs(System.out));
        SimpleInstaller.headless = true;
        try {

            if (clientInstall.run(new File(path), (a) -> true)) {
                return 0;
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return 1;
>>>>>>> cabc7c3a681d3f6ff3709c5067adbe67c3c31991
    }
}
